# ---------------------------------------------------------------------------
# 2_lines2pts.py
# Created on: Wed Mar 12 2008 04:21:13 PM
#   (generated by ArcGIS/ModelBuilder)
# Product: Bobby Sas, Student, MS Applied Geosciences, San Francisco State University
# Code: Jerry Davis and Barry Nickel, Institute for Geographic Information Science, San Francisco State University
#
# General Description: 2_lines2pts.py is step 2 of 4. Convert Polylines to Points.
# ---------------------------------------------------------------------------

import arcgisscripting, sys, os, math
gp = arcgisscripting.create()


try:
    gp.overwriteoutput = 1
##    wspath = "e:/data/geomorph"
##    inputLines = "LineTest.shp"
##    outputPts = "pt_out.shp"
    #wspath = sys.argv[1]
    inputLines = sys.argv[1]
    outputPts = sys.argv[2]
##    if not (inputLines.find(":")>0):
##        inputLines = wspath + "/" + inputLines
##    gp.workspace = wspath
    sPath, sName = os.path.split(outputPts)
    if gp.exists(outputPts):
         gp.delete_management(outputPts)
    sr = gp.CreateSpatialReference("#", str(inputLines))
    gp.CreateFeatureClass_management(sPath, sName, "point", "#", "#", "#", sr)
    # Set up input lines 
    lines = gp.SearchCursor(inputLines)
    points = gp.InsertCursor(outputPts)
    line = lines.Next()
    while line:
        linefeat = line.shape
        a = 0
        while a < linefeat.PartCount:
          # Process vertices into points for this line        
          lineArray = linefeat.GetPart(a)
          lineArray.Reset
          vertex = lineArray.Next()
          while vertex:
              pointfeat = points.NewRow()
              point = gp.CreateObject("Point")
              point.x = vertex.x
              point.y = vertex.y
              pointfeat.shape = point
              pointfeat.Id = a
              points.InsertRow(pointfeat)
              vertex = lineArray.Next()
          a = a + 1
        line = lines.Next()  
    del lines
    del points
    gp.CalculateField(outputPts, "id", "[FID] + 1")
    # gp.setparameterastext(3, outputPts)
except:
    del lines
    del points
    msg = gp.getmessages()
    gp.addmessage(msg)
    print msg

# ---------------------------------------------------------------------------
# 4_circlestats.py
# Created on: Mon Mar 17 2008 04:21:34 PM
#   (generated by ArcGIS/ModelBuilder)
# Product: Bobby Sas, Student, MS Applied Geosciences, San Francisco State University
# Code: Jerry Davis and Barry Nickel, Institute for Geographic Information Science, San Francisco State University
#
# General Description: 4_circlestats.py is step 4 of 4. Extract Slope Moments and Output into Tables. 
# ---------------------------------------------------------------------------

import arcgisscripting, sys, os, math
gp = arcgisscripting.create()
def sendmsg(msg):
    print msg
    gp.addmessage(msg)

try:
    gp.overwriteoutput = 1
    #wspath = sys.argv[1]
    inputBufs = sys.argv[1]
    inputRas = sys.argv[2]
    gp.CheckOutExtension("Spatial")
    inputDesc = gp.describe(inputBufs)
    wholePath = inputDesc.CatalogPath
    sPath, sName = os.path.split(wholePath)
    tablePath1 = sPath + "/zonalStats1.dbf"
    tablePath = sPath + "/zonalStats.dbf"
    tableTemp = sPath + "/temp.dbf"
    gp.setparameterastext(2, tablePath) 
    nBufs = gp.GetCount_Management(inputBufs)
    for i in range(nBufs):
        id = i+1
        selstr = ' "id" = ' + str(id)
        sendmsg(selstr)
        bufout = sPath + "/buf.shp"
        gp.select_analysis(inputBufs, bufout, selstr)
        gp.ZonalStatisticsAsTable_sa(bufout, "id", inputRas, tablePath1, "DATA")
        if id == 1:
            gp.copy_management(tablePath1, tablePath)
        else:
            gp.copy_management(tablePath, tableTemp) 
            vt = gp.createobject("ValueTable")
            vt.AddRow(tableTemp)
            vt.AddRow(tablePath1)
            gp.merge_management(vt, tablePath)
except:
    msg = gp.getmessages()
    gp.addmessage(msg)
    print msg
